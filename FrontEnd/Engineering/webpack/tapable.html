<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>tapable 0.2.8 | Sleepwalker&#39;s Blog</title>
    <meta name="generator" content="VuePress 1.5.3">
    
    <meta name="description" content="It's a technology blog focuses on front-end development, but not only that.">
    <link rel="preload" href="/assets/css/0.styles.8f664c61.css" as="style"><link rel="preload" href="/assets/js/app.56fc0bd4.js" as="script"><link rel="preload" href="/assets/js/2.1ec82b58.js" as="script"><link rel="preload" href="/assets/js/11.fa816a31.js" as="script"><link rel="prefetch" href="/assets/js/10.286fa350.js"><link rel="prefetch" href="/assets/js/12.e74ad920.js"><link rel="prefetch" href="/assets/js/13.0c791f2c.js"><link rel="prefetch" href="/assets/js/14.015995d6.js"><link rel="prefetch" href="/assets/js/15.f263b69f.js"><link rel="prefetch" href="/assets/js/16.2cdeb9a6.js"><link rel="prefetch" href="/assets/js/17.d409a9b2.js"><link rel="prefetch" href="/assets/js/18.75a963a2.js"><link rel="prefetch" href="/assets/js/19.67f3e2ff.js"><link rel="prefetch" href="/assets/js/20.39c5cdc5.js"><link rel="prefetch" href="/assets/js/21.a6c27b4f.js"><link rel="prefetch" href="/assets/js/3.2c5f0d7b.js"><link rel="prefetch" href="/assets/js/4.272debfe.js"><link rel="prefetch" href="/assets/js/5.60a477bb.js"><link rel="prefetch" href="/assets/js/6.c56657e0.js"><link rel="prefetch" href="/assets/js/7.02153d3d.js"><link rel="prefetch" href="/assets/js/8.151600e3.js"><link rel="prefetch" href="/assets/js/9.9270416d.js">
    <link rel="stylesheet" href="/assets/css/0.styles.8f664c61.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Sleepwalker's Blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/guide/" class="nav-link">
  Archive
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="BackEnd" class="dropdown-title"><span class="title">BackEnd</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          Nodejs
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/BackEnd/Nodejs/webFramework/middleware.html" class="nav-link">
  webFramework
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="FrontEnd" class="dropdown-title"><span class="title">FrontEnd</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          Engineering
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/FrontEnd/Engineering/vueCli/cli.html" class="nav-link">
  vueCli
</a></li><li class="dropdown-subitem"><a href="/FrontEnd/Engineering/webpack/tapable2.html" class="nav-link">
  webpack
</a></li></ul></li><li class="dropdown-item"><h4>
          Framework
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/FrontEnd/Framework/react/reactLife.html" class="nav-link">
  react
</a></li><li class="dropdown-subitem"><a href="/FrontEnd/Framework/Vue2.6.x/vueRender.html" class="nav-link">
  Vue2.6.x
</a></li><li class="dropdown-subitem"><a href="/FrontEnd/Framework/Vue3.x/notebook.html" class="nav-link">
  Vue3.x
</a></li></ul></li><li class="dropdown-item"><h4>
          Javascript
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/FrontEnd/Javascript/ECMA/reflect_set.html" class="nav-link">
  ECMA
</a></li></ul></li></ul></div></div> <a href="https://github.com/fangbinwei/blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/guide/" class="nav-link">
  Archive
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="BackEnd" class="dropdown-title"><span class="title">BackEnd</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          Nodejs
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/BackEnd/Nodejs/webFramework/middleware.html" class="nav-link">
  webFramework
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="FrontEnd" class="dropdown-title"><span class="title">FrontEnd</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          Engineering
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/FrontEnd/Engineering/vueCli/cli.html" class="nav-link">
  vueCli
</a></li><li class="dropdown-subitem"><a href="/FrontEnd/Engineering/webpack/tapable2.html" class="nav-link">
  webpack
</a></li></ul></li><li class="dropdown-item"><h4>
          Framework
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/FrontEnd/Framework/react/reactLife.html" class="nav-link">
  react
</a></li><li class="dropdown-subitem"><a href="/FrontEnd/Framework/Vue2.6.x/vueRender.html" class="nav-link">
  Vue2.6.x
</a></li><li class="dropdown-subitem"><a href="/FrontEnd/Framework/Vue3.x/notebook.html" class="nav-link">
  Vue3.x
</a></li></ul></li><li class="dropdown-item"><h4>
          Javascript
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/FrontEnd/Javascript/ECMA/reflect_set.html" class="nav-link">
  ECMA
</a></li></ul></li></ul></div></div> <a href="https://github.com/fangbinwei/blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>vueCli</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>webpack</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/FrontEnd/Engineering/webpack/tapable.html" aria-current="page" class="active sidebar-link">tapable 0.2.8</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/FrontEnd/Engineering/webpack/tapable.html#webpack-æ’ä»¶" class="sidebar-link">webpack æ’ä»¶</a></li><li class="sidebar-sub-header"><a href="/FrontEnd/Engineering/webpack/tapable.html#tapableå®ä¾‹" class="sidebar-link">tapableå®ä¾‹</a></li><li class="sidebar-sub-header"><a href="/FrontEnd/Engineering/webpack/tapable.html#tapableåˆ†æ" class="sidebar-link">tapableåˆ†æ</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/FrontEnd/Engineering/webpack/tapable.html#apply" class="sidebar-link">apply</a></li><li class="sidebar-sub-header"><a href="/FrontEnd/Engineering/webpack/tapable.html#plugin" class="sidebar-link">plugin</a></li><li class="sidebar-sub-header"><a href="/FrontEnd/Engineering/webpack/tapable.html#applyplugins" class="sidebar-link">applyPlugins</a></li><li class="sidebar-sub-header"><a href="/FrontEnd/Engineering/webpack/tapable.html#applypluginswaterfall" class="sidebar-link">applyPluginsWaterfall</a></li><li class="sidebar-sub-header"><a href="/FrontEnd/Engineering/webpack/tapable.html#applypluginsbailresult" class="sidebar-link">applyPluginsBailResult</a></li><li class="sidebar-sub-header"><a href="/FrontEnd/Engineering/webpack/tapable.html#applypluginsasync-applypluginsasyncseries" class="sidebar-link">applyPluginsAsync/applyPluginsAsyncSeries</a></li><li class="sidebar-sub-header"><a href="/FrontEnd/Engineering/webpack/tapable.html#applypluginsasyncwaterfall" class="sidebar-link">applyPluginsAsyncWaterfall</a></li><li class="sidebar-sub-header"><a href="/FrontEnd/Engineering/webpack/tapable.html#applypluginsasyncseriesbailresult" class="sidebar-link">applyPluginsAsyncSeriesBailResult</a></li><li class="sidebar-sub-header"><a href="/FrontEnd/Engineering/webpack/tapable.html#applypluginsparallel" class="sidebar-link">applyPluginsParallel</a></li><li class="sidebar-sub-header"><a href="/FrontEnd/Engineering/webpack/tapable.html#applypluginsparallelbailresult" class="sidebar-link">applyPluginsParallelBailResult</a></li></ul></li><li class="sidebar-sub-header"><a href="/FrontEnd/Engineering/webpack/tapable.html#æ€§èƒ½" class="sidebar-link">æ€§èƒ½</a></li><li class="sidebar-sub-header"><a href="/FrontEnd/Engineering/webpack/tapable.html#åº”ç”¨åœºæ™¯" class="sidebar-link">åº”ç”¨åœºæ™¯</a></li><li class="sidebar-sub-header"><a href="/FrontEnd/Engineering/webpack/tapable.html#ç—›ç‚¹" class="sidebar-link">ç—›ç‚¹</a></li></ul></li><li><a href="/FrontEnd/Engineering/webpack/tapable2.html" class="sidebar-link">tapable 2.0.0-beta.8</a></li><li><a href="/FrontEnd/Engineering/webpack/devtool.html" class="sidebar-link">devtool</a></li><li><a href="/FrontEnd/Engineering/webpack/module.html" class="sidebar-link">webpackæ‰“åŒ…ğŸ“¦å‡ºæ¥çš„ä»£ç </a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="tapable-0-2-8"><a href="#tapable-0-2-8" class="header-anchor">#</a> tapable 0.2.8</h1> <p>åœ¨webpack 1-3ä¸­, ä¾èµ–ç€tapable0.xç‰ˆæœ¬, ä½¿ç”¨å®ƒæ¥æ·»åŠ å’Œåº”ç”¨æ’ä»¶. tapable 2.xå¯¹é¡¹ç›®è¿›è¡Œäº†é‡æ„, ä»£ç éå¸¸å€¼å¾—å»åˆ†æ, è¿½æœ¬æº¯æº, äº†è§£å…¶0.xç‰ˆæœ¬çš„ä»£ç , å¹¶å¯¹æ¯”é‡æ„å‰åçš„ä»£ç , å¸Œæœ›æœ‰æ‰€æ”¶è·.</p> <p>webpackåœ¨å…¶ç¼–è¯‘è¿‡ç¨‹ä¸­,æä¾›äº†å¾ˆå¤šhooks, æ’ä»¶å¯ä»¥åœ¨è¿™äº›hooksä¸Šæ³¨å†Œå›è°ƒå‡½æ•°, è¿™äº›hooksä¹Ÿå¯ä»¥è®¤ä¸ºæ˜¯äº‹ä»¶.</p> <h2 id="webpack-æ’ä»¶"><a href="#webpack-æ’ä»¶" class="header-anchor">#</a> webpack æ’ä»¶</h2> <p>ä¸€ä¸ªæ’ä»¶åº”è¯¥æ˜¯ç±»ä¼¼å¦‚ä¸‹è¿™æ ·çš„</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// MyPlugin.js</span>

<span class="token keyword">function</span> <span class="token function">MyPlugin</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Configure your plugin with options...</span>
<span class="token punctuation">}</span>

<span class="token class-name">MyPlugin</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">apply</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">compiler</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  compiler<span class="token punctuation">.</span><span class="token function">plugin</span><span class="token punctuation">(</span><span class="token string">&quot;compile&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">params</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;The compiler is starting to compile...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> MyPlugin<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h2 id="tapableå®ä¾‹"><a href="#tapableå®ä¾‹" class="header-anchor">#</a> tapableå®ä¾‹</h2> <p>compileræ˜¯ä¸€ä¸ªtapableå­ç±»(Compiler)çš„å®ä¾‹</p> <p>æ’ä»¶æä¾›applyæ–¹æ³•, é€šè¿‡<code>compiler.plugin()</code>åœ¨compile hookä¸Šæ³¨å†Œå›è°ƒå‡½æ•°</p> <p>Compilerçš„å®ç°åº”è¯¥æ˜¯ç±»ä¼¼è¿™æ ·çš„, å½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨es6è¯­æ³•</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> Tapable <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;tapable&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">Compiler</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">Tapable</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token class-name">Compiler</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token class-name">Tapable</span><span class="token punctuation">.</span>prototype<span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>Compilerå®ä¾‹å¯ä»¥è°ƒç”¨æ³¨å†Œçš„hookså›è°ƒæ–¹æ³•</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> compiler <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Compiler</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
compiler<span class="token punctuation">.</span><span class="token function">applyPlugins</span><span class="token punctuation">(</span><span class="token string">'compile'</span><span class="token punctuation">,</span> params<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>webpacké€šè¿‡è°ƒç”¨æ’ä»¶å®šä¹‰çš„applyæ–¹æ³•, æ¥æ³¨å†Œhookså›è°ƒå‡½æ•°, å¹¶åœ¨åˆé€‚çš„æ—¶æœºæ¥æ‰§è¡Œè¿™äº›å›è°ƒå‡½æ•°. å› æ­¤tapableæ˜¯å’Œnodejsçš„EventEmitteræ˜¯æ¯”è¾ƒç±»ä¼¼çš„. tapable0.xå’ŒEventEmitteråŒæ ·éƒ½æ˜¯ä½¿ç”¨<strong>è§‚å¯Ÿè€…æ¨¡å¼</strong>æ¥å®ç°çš„.</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>tapable0.xåœ¨æ³¨å†Œhookså›è°ƒçš„æ—¶å€™éå¸¸ä¸ç›´è§‚, å› ä¸ºéƒ½æ˜¯é€šè¿‡<code>tapableInstance.plugin()</code>, æ‰€ä»¥æ³¨å†Œçš„æ˜¯å¼‚æ­¥å›è°ƒè¿˜æ˜¯åŒæ­¥å›è°ƒ, éœ€è¦ä¾æ®å…·ä½“å›è°ƒå‡½æ•°çš„å®ç°</p></div> <h2 id="tapableåˆ†æ"><a href="#tapableåˆ†æ" class="header-anchor">#</a> tapableåˆ†æ</h2> <h3 id="apply"><a href="#apply" class="header-anchor">#</a> apply</h3> <p><code>void apply(plugins: Plugin...)</code></p> <p>tapableå®ä¾‹æä¾›äº†applyæ–¹æ³•, ä»è€Œæ¥è°ƒç”¨æ’ä»¶æä¾›çš„applyæ–¹æ³•.</p> <p><a href="https://github.com/webpack/webpack/blob/cce33c206abaeef26d06b62102adf74a989a4696/lib/webpack.js#L32-L34" target="_blank" rel="noopener noreferrer">webpack3ä¸­æ˜¯è¿™æ ·è°ƒç”¨çš„<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>  <span class="token keyword">if</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>plugins <span class="token operator">&amp;&amp;</span> Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>plugins<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    compiler<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>compiler<span class="token punctuation">,</span> options<span class="token punctuation">.</span>plugins<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>å…¶å®ç°ä¹Ÿå¾ˆç®€å•</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token class-name">Tapable</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">apply</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">apply</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> arguments<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		arguments<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>éå†æ’ä»¶, è°ƒç”¨å…¶applyæ–¹æ³•, å¹¶ä¼ å…¥tapableå®ä¾‹ä½œä¸ºå‚æ•°.</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>tapable1.xä»¥å, applyå°±è¢«åºŸå¼ƒäº†, webpackä¼šç›´æ¥è°ƒç”¨æ’ä»¶çš„applyæ–¹æ³•. è¿™æ ·tapableå°±å¯ä»¥æ›´åŠ ä¸“æ³¨äºhooksçš„æ³¨å†Œå’Œè°ƒç”¨.</p></div> <h3 id="plugin"><a href="#plugin" class="header-anchor">#</a> plugin</h3> <p><code>void plugin(names: string|string[], handler: Function)</code></p> <p>é€šè¿‡pluginæ–¹æ³•, å¯ä»¥æ³¨å†Œä¸€ä¸ªæˆ–å¤šä¸ªhookså›è°ƒå‡½æ•°</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Tapable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">this</span><span class="token punctuation">.</span>_plugins <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token class-name">Tapable</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">plugin</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">plugin</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		name<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">plugin</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> fn<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>_plugins<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_plugins<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>fn<span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token keyword">else</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_plugins<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>å¦‚æœ<code>name</code>æ˜¯æ•°ç»„, åˆ™é€’å½’è°ƒç”¨<code>plugin</code>æ–¹æ³•, å†…éƒ¨ç»´æŠ¤<code>_plugins</code>å¯¹è±¡, æ¥ç®¡ç†æ‰€æ³¨å†Œçš„hookså›è°ƒ.</p> <h3 id="applyplugins"><a href="#applyplugins" class="header-anchor">#</a> applyPlugins</h3> <p><code>void applyPlugins(name: string, args: any...)</code></p> <p><img src="https://image.fangbinwei.cn/FrontEnd/Engineering/webpack/tapable/applyPlugins.svg" alt="applyPlugins"></p> <p>é’ˆå¯¹æ³¨å†Œçš„å›è°ƒå‡½æ•°ä¸ºåŒæ­¥å‡½æ•°</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token class-name">Tapable</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">applyPlugins</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">applyPlugins</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>_plugins<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
	<span class="token keyword">var</span> args <span class="token operator">=</span> <span class="token class-name">Array</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>arguments<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">var</span> plugins <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_plugins<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> plugins<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
		plugins<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>æ ¹æ®ä¼ å…¥çš„<code>name</code>æ‰¾åˆ°<code>_plugins</code>ä¸‹çš„æ‰€æœ‰å›è°ƒå‡½æ•°, éå†æ‰§è¡Œ.</p> <h3 id="applypluginswaterfall"><a href="#applypluginswaterfall" class="header-anchor">#</a> applyPluginsWaterfall</h3> <p><code>any applyPluginsWaterfall(name: string, init: any, args: any...)</code></p> <p><img src="https://image.fangbinwei.cn/FrontEnd/Engineering/webpack/tapable/applyPluginsWaterfall.svg" alt="applyPluginsWaterfall"></p> <p>é’ˆå¯¹å›è°ƒå‡½æ•°ä¸ºåŒæ­¥å‡½æ•°, ä½¿ç”¨<code>Waterfall</code>çš„æ–¹å¼</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token class-name">Tapable</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">applyPluginsWaterfall</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">applyPluginsWaterfall</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> init</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>_plugins<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">return</span> init<span class="token punctuation">;</span>
	<span class="token keyword">var</span> args <span class="token operator">=</span> <span class="token class-name">Array</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>arguments<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">var</span> plugins <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_plugins<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token keyword">var</span> current <span class="token operator">=</span> init<span class="token punctuation">;</span>
	<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> plugins<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> current<span class="token punctuation">;</span>
		current <span class="token operator">=</span> plugins<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> current<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>waterfallçš„æ–¹å¼ä¼šå°†ä¸Šä¸€ä¸ªcallback returnçš„å€¼,ä¼ ç»™ä¸‹ä¸€ä¸ªcallback.</p> <p><code>applyPluginsWaterfall</code>çš„<code>init</code>å‚æ•°ä¸ºä¼ ç»™ç¬¬ä¸€ä¸ªcallbackçš„å€¼, ç„¶åä¸æ–­å°†<code>args[0]</code>æ›¿æ¢æˆcallback returnçš„å€¼, ä»è€Œè¿›è¡Œä¼ é€’</p> <h3 id="applypluginsbailresult"><a href="#applypluginsbailresult" class="header-anchor">#</a> applyPluginsBailResult</h3> <p><code>any applyPluginsBailResult(name: string, args: any...)</code> <img src="https://image.fangbinwei.cn/FrontEnd/Engineering/webpack/tapable/applyPluginsBailResult.svg" alt="applyPluginsBailResult"></p> <p>é’ˆå¯¹å›è°ƒå‡½æ•°ä¸ºåŒæ­¥å‡½æ•°, ä½¿ç”¨<code>Bail</code>çš„æ–¹å¼</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token class-name">Tapable</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">applyPluginsBailResult</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">applyPluginsBailResult</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>_plugins<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
	<span class="token keyword">var</span> args <span class="token operator">=</span> <span class="token class-name">Array</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>arguments<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">var</span> plugins <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_plugins<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> plugins<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">var</span> result <span class="token operator">=</span> plugins<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> result <span class="token operator">!==</span> <span class="token string">&quot;undefined&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> result<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>bailçš„æ–¹å¼, ä¼šé¡ºåºè°ƒç”¨callbacks, å¦‚æœé‡åˆ°æŸä¸ªcallback return é<code>undefined</code>çš„å€¼, åˆ™è·³å‡ºå¾ªç¯, ä¸å†æ‰§è¡Œæ¥ä¸‹å»çš„callbacks. å…¶ä»£ç å’Œ<code>applyPlugins</code>éå¸¸ç±»ä¼¼.</p> <h3 id="applypluginsasync-applypluginsasyncseries"><a href="#applypluginsasync-applypluginsasyncseries" class="header-anchor">#</a> applyPluginsAsync/applyPluginsAsyncSeries</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">applyPluginsAsyncSeries</span><span class="token punctuation">(</span>
	name<span class="token operator">:</span> string<span class="token punctuation">,</span>
	args<span class="token operator">:</span> any<span class="token operator">...</span><span class="token punctuation">,</span>
	callback<span class="token operator">:</span> <span class="token punctuation">(</span>err<span class="token operator">:</span> Error<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token keyword">void</span>
<span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><img src="https://image.fangbinwei.cn/FrontEnd/Engineering/webpack/tapable/applyPluginsAsyncSeries.svg" alt="applyPluginsAsyncSeries"></p> <p>æ³¨å†Œçš„å›è°ƒå‡½æ•°æ˜¯å¼‚æ­¥çš„, å¯ä»¥ä½¿ç”¨è¿™ä¸ªæ–¹æ³•æ¥ä¿è¯å„ä¸ªå›è°ƒå‡½æ•°æ˜¯é¡ºåºæ‰§è¡Œçš„</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token class-name">Tapable</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>applyPluginsAsyncSeries <span class="token operator">=</span> <span class="token class-name">Tapable</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">applyPluginsAsync</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">applyPluginsAsyncSeries</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> args <span class="token operator">=</span> <span class="token class-name">Array</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>arguments<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// æœ€åä¸€ä¸ªå‚æ•°æ˜¯callback</span>
	<span class="token keyword">var</span> callback <span class="token operator">=</span> args<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> plugins <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_plugins<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token comment">// è‹¥æ²¡æœ‰æ³¨å†Œå›è°ƒå‡½æ•°, ç›´æ¥æ‰§è¡Œcallback</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>plugins <span class="token operator">||</span> plugins<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> _this <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
  <span class="token comment">// å°†callbackåŒ…è£…ä¸ºnextå‡½æ•°</span>
	args<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token function">copyProperties</span><span class="token punctuation">(</span>callback<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// å¦‚æœæœ‰é”™è¯¯</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">callback</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
    i<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token comment">// æ‰€æœ‰æ³¨å†Œçš„å›è°ƒæ‰§è¡Œå®Œæ¯•, æ‰§è¡Œcallback</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>i <span class="token operator">&gt;=</span> plugins<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// æ‰§è¡Œå›è°ƒå‡½æ•°</span>
		plugins<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>_this<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	plugins<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">copyProperties</span><span class="token punctuation">(</span><span class="token parameter"><span class="token keyword">from</span><span class="token punctuation">,</span> to</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> key <span class="token keyword">in</span> <span class="token keyword">from</span><span class="token punctuation">)</span>
		to<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">from</span><span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> to<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><p>æ³¨å†Œçš„hookå›è°ƒå‡½æ•°æ˜¯å¼‚æ­¥çš„, è¿™ä¸ªå›è°ƒå‡½æ•°æ¥æ”¶çš„æœ€åä¸€ä¸ªå‚æ•°æ˜¯<code>next(err: Error)</code>å‡½æ•°</p> <p>é€šè¿‡è°ƒç”¨nextå‡½æ•°æ¥æ‰§è¡Œä¸‹ä¸€ä¸ªæ³¨å†Œçš„å›è°ƒå‡½æ•°, åœ¨æ‰€æœ‰æ³¨å†Œçš„å›è°ƒå‡½æ•°éƒ½æ‰§è¡Œå®Œå, ä¼šæ‰§è¡Œ<code>callback(err: Error)</code>(applyPluginsAsyncSeriesçš„æœ€åä¸€ä¸ªå‚æ•°)</p> <p>åˆæˆ–è€…æ³¨å†Œçš„å›è°ƒå‡½æ•°ç»™nextä¼ é€’äº†error, åˆ™ä¼šç»ˆæ­¢åç»­é€»è¾‘, å¹¶æ‰§è¡Œ<code>callback(err)</code></p> <h3 id="applypluginsasyncwaterfall"><a href="#applypluginsasyncwaterfall" class="header-anchor">#</a> applyPluginsAsyncWaterfall</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">applyPluginsAsyncWaterfall</span><span class="token punctuation">(</span>
	name<span class="token operator">:</span> string<span class="token punctuation">,</span>
	init<span class="token operator">:</span> any<span class="token punctuation">,</span>
	callback<span class="token operator">:</span> <span class="token punctuation">(</span>err<span class="token operator">:</span> Error<span class="token punctuation">,</span> result<span class="token operator">:</span> any<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token keyword">void</span>
<span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><img src="https://image.fangbinwei.cn/FrontEnd/Engineering/webpack/tapable/applyPluginsAsyncWaterfall.svg" alt="applyPluginsAsyncWaterfall"></p> <p>æ³¨å†Œçš„å›è°ƒå‡½æ•°æ˜¯å¼‚æ­¥çš„, ä½¿ç”¨<code>Waterfall</code>çš„æ–¹å¼</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token class-name">Tapable</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">applyPluginsAsyncWaterfall</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">applyPluginsAsyncWaterfall</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> init<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>_plugins<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_plugins<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> init<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">var</span> plugins <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_plugins<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token keyword">var</span> _this <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
	<span class="token keyword">var</span> next <span class="token operator">=</span> <span class="token function">copyProperties</span><span class="token punctuation">(</span>callback<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">callback</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
		i<span class="token operator">++</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>i <span class="token operator">&gt;=</span> plugins<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		plugins<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>_this<span class="token punctuation">,</span> value<span class="token punctuation">,</span> next<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	plugins<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> init<span class="token punctuation">,</span> next<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>å¯ä»¥å‘ç°å…¶å’Œ<code>applyPluginsAsyncSeries</code>çš„ä»£ç éå¸¸ç±»ä¼¼, éƒ½æ˜¯é€šè¿‡nextå‡½æ•°æ¥å’Œä¸‹ä¸€ä¸ªå›è°ƒå‡½æ•°å»ºç«‹è¿æ¥, ä½†æ˜¯<code>applyPluginsAsyncWaterfall</code>è¿˜å¯ä»¥é€šè¿‡next(null, value)æ¥ä¼ é€’valueç»™ä¸‹ä¸€ä¸ªå›è°ƒå‡½æ•°.</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p><code>applyPluginsWaterfall(name: String, init: any, args: any...)</code>é™¤äº†ä¼ é€’initå‚æ•°, è¿˜å¯ä»¥ç»§ç»­ä¼ é€’å‚æ•°</p> <p><code>applyPluginsAsyncWaterfall</code>åˆ™åªèƒ½ä¼ é€’ä¸€ä¸ªinitå‚æ•°å’Œä¸€ä¸ªcallbackå‚æ•°</p></div> <h3 id="applypluginsasyncseriesbailresult"><a href="#applypluginsasyncseriesbailresult" class="header-anchor">#</a> applyPluginsAsyncSeriesBailResult</h3> <p>æ³¨å†Œçš„å›è°ƒå‡½æ•°æ˜¯å¼‚æ­¥çš„, ä½¿ç”¨<code>Bail</code>çš„æ–¹å¼</p> <div class="language-js line-numbers-mode"><div class="highlight-lines"><br><br><br><br><br><br><br><br><div class="highlighted">Â </div><br><br><br><br><br><br><br><br><br><br></div><pre class="language-js"><code><span class="token class-name">Tapable</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">applyPluginsAsyncSeriesBailResult</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">applyPluginsAsyncSeriesBailResult</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">var</span> args <span class="token operator">=</span> <span class="token class-name">Array</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>arguments<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">var</span> callback <span class="token operator">=</span> args<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>_plugins<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_plugins<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">var</span> plugins <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_plugins<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token keyword">var</span> _this <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
	args<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token function">copyProperties</span><span class="token punctuation">(</span>callback<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>arguments<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">callback</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
		i<span class="token operator">++</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>i <span class="token operator">&gt;=</span> plugins<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		plugins<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>_this<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	plugins<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>å…¶å®ç°å’Œ<code>applyPluginsAsyncSeries</code>ç±»ä¼¼</p> <h3 id="applypluginsparallel"><a href="#applypluginsparallel" class="header-anchor">#</a> applyPluginsParallel</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">applyPluginsParallel</span><span class="token punctuation">(</span>
	name<span class="token operator">:</span> string<span class="token punctuation">,</span>
	args<span class="token operator">:</span> any<span class="token operator">...</span><span class="token punctuation">,</span>
	callback<span class="token operator">:</span> <span class="token punctuation">(</span>err<span class="token operator">?</span><span class="token operator">:</span> Error<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token keyword">void</span>
<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>æ‰§è¡Œå„ä¸ªå›è°ƒå‡½æ•°, å›è°ƒå‡½æ•°å¯èƒ½æ˜¯å¼‚æ­¥çš„, å’Œ<code>Promise.all</code>ç±»ä¼¼</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token class-name">Tapable</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">applyPluginsParallel</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">applyPluginsParallel</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">var</span> args <span class="token operator">=</span> <span class="token class-name">Array</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>arguments<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">var</span> callback <span class="token operator">=</span> args<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>_plugins<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_plugins<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">var</span> plugins <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_plugins<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token keyword">var</span> remaining <span class="token operator">=</span> plugins<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
	args<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token function">copyProperties</span><span class="token punctuation">(</span>callback<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>remaining <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span> <span class="token comment">// ignore</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			remaining <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
			<span class="token keyword">return</span> <span class="token function">callback</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		remaining<span class="token operator">--</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>remaining <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> plugins<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		plugins<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>remaining <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>æ‰§è¡Œå„ä¸ªæ³¨å†Œçš„å›è°ƒå‡½æ•°, å¹¶è®°å½•è¿˜æœªæ‰§è¡Œå®Œçš„æ•°é‡, å½“å…¨éƒ¨éƒ½æ‰§è¡Œå®Œå, å°±æ‰§è¡Œcallback.</p> <h3 id="applypluginsparallelbailresult"><a href="#applypluginsparallelbailresult" class="header-anchor">#</a> applyPluginsParallelBailResult</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">applyPluginsParallelBailResult</span><span class="token punctuation">(</span>
	name<span class="token operator">:</span> string<span class="token punctuation">,</span>
	args<span class="token operator">:</span> any<span class="token operator">...</span><span class="token punctuation">,</span>
	callback<span class="token operator">:</span> <span class="token punctuation">(</span>err<span class="token operator">:</span> Error<span class="token punctuation">,</span> result<span class="token operator">:</span> any<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token keyword">void</span>
<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token class-name">Tapable</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">applyPluginsParallelBailResult</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">applyPluginsParallelBailResult</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">var</span> args <span class="token operator">=</span> <span class="token class-name">Array</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>arguments<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">var</span> callback <span class="token operator">=</span> args<span class="token punctuation">[</span>args<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>_plugins<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_plugins<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">var</span> plugins <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_plugins<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token keyword">var</span> currentPos <span class="token operator">=</span> plugins<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
	<span class="token keyword">var</span> currentResult<span class="token punctuation">;</span>
	<span class="token keyword">var</span> done <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> plugins<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		args<span class="token punctuation">[</span>args<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">i</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> <span class="token function">copyProperties</span><span class="token punctuation">(</span>callback<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token keyword">if</span><span class="token punctuation">(</span>i <span class="token operator">&gt;=</span> currentPos<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span> <span class="token comment">// ignore</span>
				done<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">if</span><span class="token punctuation">(</span>arguments<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
					currentPos <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
					done <span class="token operator">=</span> <span class="token function">fastFilter</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>done<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
						<span class="token keyword">return</span> item <span class="token operator">&lt;=</span> i<span class="token punctuation">;</span>
					<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					currentResult <span class="token operator">=</span> <span class="token class-name">Array</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
				<span class="token keyword">if</span><span class="token punctuation">(</span>done<span class="token punctuation">.</span>length <span class="token operator">===</span> currentPos<span class="token punctuation">)</span> <span class="token punctuation">{</span>
					<span class="token function">callback</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> currentResult<span class="token punctuation">)</span><span class="token punctuation">;</span>
					currentPos <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		plugins<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><p>å¦‚æœæ³¨å†Œå›è°ƒå¦‚ä¸‹,</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>tapableInstance<span class="token punctuation">.</span><span class="token function">plugin</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">cb</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">cb</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">'params1'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
tapableInstance<span class="token punctuation">.</span><span class="token function">plugin</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">cb</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">cb</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">'params2'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

tapableInstance<span class="token punctuation">.</span><span class="token function">applyPluginsParallelBailResult</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> arg</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span> <span class="token comment">// params1</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>æ‰§è¡Œå„ä¸ªæ³¨å†Œçš„å›è°ƒå‡½æ•°, å¦‚æœæŸä¸ªå‡½æ•°è°ƒç”¨äº†cb, ä¸”ä¼ é€’äº†å€¼(æ— è®ºä¼ äº†err, æˆ– result), é‚£ä¹ˆåˆ¤æ–­è°ƒåœ¨å…¶å‰é¢æ³¨å†Œçš„å›è°ƒå‡½æ•°æ˜¯å¦éƒ½æ‰§è¡Œè¿‡next(æ²¡æœ‰ä¼ å€¼), å¦‚æœéƒ½æ‰§è¡Œè¿‡, åˆ™è°ƒç”¨<code>callback(null, 'params')</code></p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p><code>applyPluginsParallelBailResult</code>, æ‰§è¡Œcallbackçš„æ¡ä»¶å’Œ<code>applyPluginsBailResult</code>å…¶å®æ˜¯ç±»ä¼¼çš„</p> <p><code>applyPluginsBailResult</code>æ‰§è¡Œcallbackçš„æ¡ä»¶æ˜¯, å‰é¢æ³¨å†Œçš„å›è°ƒå‡½æ•°éƒ½return undefined, ç›´åˆ°æ‰§è¡Œåˆ°æŸä¸ªå›è°ƒå‡½æ•°return éundefined.</p> <p><code>applyPluginsParallelBailResult</code>æ‰§è¡Œcallbackçš„æ¡ä»¶æ˜¯,æŸä¸ªæ³¨å†Œçš„å›è°ƒå‡½æ•°è°ƒç”¨äº†cb,ä¸”ä¼ å€¼äº†, ä¸”åœ¨å…¶ä¹‹å‰æ³¨å†Œçš„å›è°ƒå‡½æ•°å…¨éƒ½è°ƒç”¨äº†cb, ä¸”æœªä¼ å€¼.</p></div> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>applyPluginsAsync***çš„æ–¹æ³•, è™½è¯´æ˜¯é’ˆå¯¹æ³¨å†Œçš„å›è°ƒå‡½æ•°ä¸ºå¼‚æ­¥çš„æƒ…å†µ, ä½†æ˜¯å¦‚æœæ³¨å†Œçš„å›è°ƒå‡½æ•°æ˜¯åŒæ­¥çš„, ä¹Ÿæ˜¯é€‚ç”¨çš„.</p></div> <h2 id="æ€§èƒ½"><a href="#æ€§èƒ½" class="header-anchor">#</a> æ€§èƒ½</h2> <p>åœ¨tapable0.xä¸­çš„ä»£ç ä¸­è¿˜æœ‰<code>applyPlugins0</code>,<code>applyPlugins1</code>ç­‰æ–¹æ³•, å†…éƒ¨ä½¿ç”¨å‡½æ•°çš„<code>call</code>æ¥ä»£æ›¿<code>apply</code>æ¥æ‰§è¡Œå›è°ƒ, ä»è€Œæå‡æ€§èƒ½, <a href="https://jsperf.com/tapable" target="_blank" rel="noopener noreferrer">jsperfæµ‹è¯•ä»£ç <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="åº”ç”¨åœºæ™¯"><a href="#åº”ç”¨åœºæ™¯" class="header-anchor">#</a> åº”ç”¨åœºæ™¯</h2> <p>TODO:</p> <h2 id="ç—›ç‚¹"><a href="#ç—›ç‚¹" class="header-anchor">#</a> ç—›ç‚¹</h2> <p>tapable0.xä»£ç é‡å¤åº¦è¿˜æ˜¯æ¯”è¾ƒé«˜çš„</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/fangbinwei/blog/edit/master/FrontEnd/Engineering/webpack/tapable.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">7/25/2020, 5:31:59 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      â†
      <a href="/FrontEnd/Engineering/vueCli/cli.html" class="prev">
        cli
      </a></span> <span class="next"><a href="/FrontEnd/Engineering/webpack/tapable2.html">
        tapable 2.0.0-beta.8
      </a>
      â†’
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.56fc0bd4.js" defer></script><script src="/assets/js/2.1ec82b58.js" defer></script><script src="/assets/js/11.fa816a31.js" defer></script>
  </body>
</html>
